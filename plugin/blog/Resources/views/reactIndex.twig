{% extends 'ClarolineCoreBundle:Workspace:layout.html.twig' %}

{% block title %}{{ _resource.resourceNode.name }}{% endblock %}

{% set blogOptions = _resource.options %}
{% block content %}
   <div class="page-container blog-container" 
     data-blog="{{ _resource | api_serialize | json_encode | raw | escape }}"
     data-resource-node="{{ _resource.resourceNode | api_serialize | json_encode | raw | escape }}"
   >
   </div>
{% endblock %}

{% set calendarPath = 'packages/fullcalendar/dist/' %}

{% block stylesheets %}
    {{ parent() }}
    <link rel='stylesheet' type='text/css' href='{{ asset('bundles/clarolinecore/css/common/jquery-ui-bootstrap/jquery-ui-1.9.2.custom.css') }}'/>
    <link rel="stylesheet" type='text/css' href="{{ asset('packages/angular-loading-bar/build/loading-bar.min.css') }}" />
    <link rel='stylesheet' type='text/css' href='{{ asset(calendarPath ~ 'fullcalendar.min.css') }}'/>
    <link rel='stylesheet' type='text/css' href='{{ asset(calendarPath ~ 'fullcalendar.print.css') }}' media='print' />

    {% stylesheets debug=false filter='less'  output='css/icapblog/style.css'
    "@IcapBlogBundle/Resources/views/less/style.less"
    %}
    <link rel="stylesheet" href="{{ asset_url }}" screen="media" />
    {% endstylesheets %}

    {% if blogOptions.isBannerActivate or (false == blogOptions.isBannerActivate and is_granted('ADMINISTRATE', _resource)) %}
        <link rel="stylesheet" href="{{ asset('packages/angular-bootstrap-colorpicker/css/colorpicker.min.css') }}" screen="media" />
    {% endif %}

{% endblock %}

{% block javascripts %}
    {{ parent() }}

    <script type="text/javascript">

        window.blogConfiguration = {

            id: {{ _resource.id }},
            name: "{{ _resource.resourceNode.name }}",
            user: {{ user | default('null') }},
            rssUrl: "{{ path('icap_blog_rss', {'blogId': blog.id}) }}",
            loginUrl: "{{ path('claro_security_login') }}",
            eventSources: [{url: '{{ path('icap_blog_calendar_datas', {'blogId': _resource.id}) }}'}],
            img_dir: "{{ asset('uploads/pictures/') }}",
            banner_dir: "{{ asset(get_blog_upload_dir()) }}",
            bannerImgStyle: "{% if null == get_blog_banner(_resource) %}none{% else %}url('{{ asset(get_blog_banner_web_path(_resource)) }}'){% endif %}",
            options: {{ options | raw }},
            panels: {{ orderPanels | json_encode() | raw }},
            archives: {{ archiveData | json_encode() | raw }},
            authors: {{ blog_authors(_resource) | json_encode() | raw }},
            tags: {{ blog_tags(blog) | json_encode() | raw }},
            isGrantedAdmin: {{ is_granted('ADMINISTRATE', _resource) ? 'true':'false' }},
            isGrantedEdit: {{ is_granted('EDIT', _resource) ? 'true':'false' }},
            isGrantedPost: {{ is_granted('POST', _resource) ? 'true':'false' }},

        }
    </script>

    <script src="{{ url('bazinga_jstranslation_js', { 'domain': 'agenda' }) }}?locales=fr,en"></script>
    <script src="{{ url('bazinga_jstranslation_js', { 'domain': 'icap_blog' }) }}?locales=fr,en"></script>

    <script type="text/javascript" src="{{ hotAsset('dist/claroline-distribution-plugin-blog-blog.js') }}" ></script>


    {% block icap_blog_javascripts %}
    {% endblock icap_blog_javascripts %}
{% endblock javascripts %}
