version: '2'
services:
  web:
    restart: always
    build: web/
    ports:
      - 80:80
    volumes:
      - .:/var/www/html/claroline # This is where the symfony files are stored
    environment:
      VIRTUAL_HOST: https://${APP_URL}, http://${APP_URL} # Both http and https are needed for http->https redirection to work
      FORCE_SSL: "yes" # Force redirech http to https

      APP_URL: ${APP_URL}
      DB_HOST: db
      DB_NAME: ${DB_NAME}
      DB_USER: ${DB_USER}
      DB_PASSWORD: ${DB_PASSWORD}
      SECRET: ${SECRET}

      # These will be the default platform options, they are only used once during the Claroline Connect install
      PLATFORM_NAME: ${PLATFORM_NAME}
      PLATFORM_SUPPORT_EMAIL: ${PLATFORM_SUPPORT_EMAIL}
      PLATFORM_SSL_ENABLED: ${PLATFORM_SSL_ENABLED}
      PLATFORM_LOCALE_LANGUAGE: ${PLATFORM_LOCALE_LANGUAGE}
      PLATFORM_THEME: ${PLATFORM_THEME}
      PLATFORM_MAILER_TRANSPORT: ${PLATFORM_MAILER_TRANSPORT}
      PLATFORM_MAILER_HOST: ${PLATFORM_MAILER_HOST}
      PLATFORM_MAILER_PORT: ${PLATFORM_MAILER_PORT}
      PLATFORM_MAILER_ENCRYPTION: ${PLATFORM_MAILER_ENCRYPTION}
      PLATFORM_MAILER_USERNAME: ${PLATFORM_MAILER_USERNAME}
      PLATFORM_MAILER_PASSWORD: ${PLATFORM_MAILER_PASSWORD}
      PLATFORM_MAILER_AUTH_MODE: ${PLATFORM_MAILER_AUTH_MODE}
      PLATFORM_MAX_STORAGE_SIZE: ${PLATFORM_MAX_STORAGE_SIZE}
      PLATFORM_MAX_UPLOAD_RESOURCES: ${PLATFORM_MAX_UPLOAD_RESOURCES}
      PLATFORM_MAX_WORKSPACE_USERS: ${PLATFORM_MAX_WORKSPACE_USERS}
      PLATFORM_IS_PDF_EXPORT_ACTIVE: ${PLATFORM_IS_PDF_EXPORT_ACTIVE}

      # The first user to be created, this is only used once during the Claroline Connect install
      ADMIN_FIRSTNAME: ${ADMIN_FIRSTNAME}
      ADMIN_LASTNAME: ${ADMIN_LASTNAME}
      ADMIN_USERNAME: ${ADMIN_USERNAME}
      ADMIN_PASSWORD: ${ADMIN_PASSWORD}
      ADMIN_EMAIL: ${ADMIN_EMAIL}

  db:
    restart: always
    image: mysql
    networks:
      - db
    volumes:
      - ./.docker/mysql/my.cnf:/etc/mysql/conf.d/my.cnf
      - mysql:/var/lib/mysql
    environment:
      MYSQL_ROOT_PASSWORD: ${DB_ROOT_PASSWORD}
      MYSQL_USER: ${DB_USER}
      MYSQL_PASSWORD: ${DB_PASSWORD}
      MYSQL_DATABASE: ${DB_NAME}
      
volumes:
  mysql: # This is where the mysql data lives
